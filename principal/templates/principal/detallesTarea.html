{% extends "plataforma/menu.html" %}
{% block title %} Inicio {% endblock %}
{% block contenido %}

<div class="mb-4">
    <h1>Tarea: {{tarea.titulo}}</h1>
    <p class="text-muted">Fecha de entrega: {{tarea.fecha_entrega|date:"d/m/Y H:i"}}</p>
    <br>
    <div class="row">
        <div class="col-md-7">
            <div>
                <p style="text-align:justify">{{tarea.descripcion}} </p>
            </div>
        </div>
        <div class="col-md-5">
            {% if is_alumno %}
            <div class="card border-2 border-success h-100">
                <div class="card-body">
                    <h5 class="card-title">Subir tarea</h5>
                    <form method="post" enctype="multipart/form-data" action="{% url 'entregar_tarea' tarea.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="entrega_form_submit" value="1">
                        {{ entrega_form.as_p }}
                        <button type="submit" class="btn sidebar-button">Enviar</button>
                    </form>
                </div>
            </div>
            {% else %}
            <br>
            <a class="btn sidebar-button" href="{% url 'entregas' tarea.id %}">Ver entregas</a>
            <button type="button" class="btn boton-naranja" data-bs-toggle="modal"
                data-bs-target="#confirmacionEliminar">Eliminar tarea</button>
            {% endif %}
        </div>

        <br>
        <div class="col-md-7">
            <h1>Material</h1>
            {% if tarea.archivo %}
            <div class="alert alert-info" role="alert">
                <p>Se ha adjuntado un archivo para esta tarea. Puedes descargarlo haciendo clic en el botón.</p>
                <a href="{{ tarea.archivo.url }}" class="btn btn-primary" download>Descargar archivo</a>
            </div>
            {% else %}
            <div class="alert alert-warning" role="alert">
                <h4 class="alert-heading">No se agregó ningún material para esta tarea.</h4>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="col-md-9">
    <h1>Blog de dudas</h1>
    <p>En esta sección se pueden agregar comentarios o preguntas sobre la tarea.</p>

    <div class="mt-4">
        {% for duda in dudas %}
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ duda.autor.username }}</h5>
                    <p class="card-text">{{ duda.contenido }}</p>
                    <small class="text-muted">{{ duda.fecha_creacion|date:"d/m/Y H:i" }}</small>
                </div>
            </div>
        {% empty %}
            <div class="alert alert-info">
                Aún no hay dudas sobre esta tarea. ¡Sé el primero en preguntar!
            </div>
        {% endfor %}

        <div class="mt-4">
            <h3>Publicar una nueva duda</h3>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="duda_form_submit" value="1">
                {{ duda_form.as_p }}
                <button type="submit" class="btn btn-primary">Enviar Duda</button>
            </form>
        </div>
    </div>
</div>
</div>

<div class="modal fade" id="confirmacionEliminar" tabindex="-1" aria-labelledby="confirmacionEliminarLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmacionEliminarLabel">¿Estás seguro de que deseas eliminar esta tarea?
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'eliminar_tarea' tarea.id %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <p>Esta acción no se puede deshacer.</p>
                        <input type="hidden" name="tarea_id" value="{{ tarea.id }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Eliminar</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}